(()=>{"use strict";function e(e){let t=document.querySelector(".header-personal");t.querySelector("p").innerHTML=e.name,t.querySelector("img").src=e.avatar,document.querySelector(".logout").style.display="none";let n=document.querySelector(".quit");n.style.display="block",n.addEventListener("click",(function(){localStorage.removeItem("currentUser"),window.location.reload()}))}function t(){let e=document.querySelector(".sign-up-name").value,t=document.querySelector(".sign-up-email").value,n=document.querySelector(".sign-up-password").value,o=document.querySelector(".sign-up-native-name").value,r=document.querySelector("select").value;r="male"===r?1:2;let l=new XMLHttpRequest,s={name:e,email:t,password:n,nativeName:o,gender:r},c=JSON.stringify(s),a=new Headers;a.append("Access-Control-Allow-Credentials","true"),a.append("Access-Control-Allow-Origin","*"),a.append("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),l.open("POST","http://127.0.0.1:3000/api/users"),l.setRequestHeader("Content-type","application/json; charset=utf-8"),l.send(c)}let n=document.querySelector(".grid-view"),o=document.querySelector(".table-view"),r=document.querySelector(".sort-button");function l(){let e=document.querySelectorAll(".employee-single");for(let t of e)t.classList.add("table-view");o.classList.add("active"),n.classList.remove("active"),r.style.display="block"}function s(){let e=document.querySelectorAll(".employee-single");for(let t of e)t.classList.remove("table-view");o.classList.remove("active"),n.classList.add("active"),r.style.display="none"}o.addEventListener("click",l),n.addEventListener("click",s),r.addEventListener("click",(function(){!function(e){const t=document.querySelectorAll(".employee-single"),n={},o=t[0].parentNode;t.forEach((e=>{const t=e.querySelector(".name").innerText;n[t]=e,e.parentNode.removeChild(e)})),Object.keys(n).sort().forEach((e=>o.appendChild(n[e])))}()})),window.onload=function(){!function(){let e=new XMLHttpRequest;e.open("GET","http://127.0.0.1:3000/api/users"),e.send(),e.onload=function(){if(200!==e.status)console.log(`Ошибка ${e.status}: ${e.statusText}`);else{let t=JSON.parse(e.response);a(t),function(e){let t=document.querySelector(".employees-settings");for(let n of e){let e=document.querySelector("#settings-template").content.cloneNode(!0);e.querySelector("img").src=n.avatar;let o=e.querySelector(".name");o.innerHTML=n.name,o.setAttribute("user-id",n.id),e.querySelector(".nativeName").innerHTML=n.nativeName;for(let t of n.roles)switch(t.type){case"addressbook":let n=e.querySelector(".address-role").querySelectorAll("button");switch(t.name){case"employee":n[0].classList.add("active"),n[1].classList.remove("active");break;case"hr":n[1].classList.add("active"),n[0].classList.remove("active")}case"vacation":let o=e.querySelector(".vacation-role").querySelectorAll("button");switch(t.name){case"employee":o[0].classList.add("active"),o[1].classList.remove("active"),o[2].classList.remove("active");break;case"po":o[0].classList.remove("active"),o[1].classList.add("active"),o[2].classList.remove("active");break;case"dd":o[0].classList.remove("active"),o[1].classList.remove("active"),o[2].classList.add("active")}case"admin":let r=e.querySelector(".admin-role").querySelector("button");switch(t.status){case"true":r.classList.add("active");let t=e.querySelector(".address-role").querySelectorAll("button");for(let e of t)e.classList.remove("active"),e.classList.add("disabled");break;case"false":r.classList.remove("active")}}t.append(e)}}(t)}}}();let t=JSON.parse(localStorage.getItem("currentUser"));t?e(t):i()},window.addEventListener("load",(function(){let e=document.querySelectorAll("ul.nav-tabs > li");function t(t){for(let t=0;t<e.length;t++)e[t].classList.remove("active");t.currentTarget.classList.add("active"),t.preventDefault();let n=document.querySelectorAll(".tab-pane");for(let e=0;e<n.length;e++)n[e].classList.remove("active");let o=t.target.getAttribute("href");document.querySelector(o).classList.add("active");let r=document.querySelector(".employees-block"),l=document.querySelector(".card-information");l&&(l.remove(),r.style.display="block")}for(let n=0;n<e.length;n++)e[n].addEventListener("click",t)}));let c=document.querySelector(".table-view");function a(e){let t=document.querySelector(".employees-cards");for(let n of e){let e=document.querySelector("#temp-card").content.cloneNode(!0);e.querySelector("img").src=n.avatar;let o=e.querySelector(".name");o.innerHTML=n.name,o.setAttribute("user-id",n.id),e.querySelector(".nativeName").innerHTML=n.nativeName,e.querySelector(".department").innerHTML='<i class="fa fa-briefcase"></i>'+n.department,e.querySelector(".room").innerHTML='<i class="far fa-address-book"></i>'+n.room,t.append(e)}document.querySelector(".employees-number").innerText=e.length,c.classList.contains("active")?l():s(),function(){let e=document.querySelectorAll(".employee-single");for(let n of e)n.addEventListener("click",(function(e){e.preventDefault(),t(n.querySelector(".name").getAttribute("user-id"))}));function t(e){let t=new XMLHttpRequest;t.open("GET",`http://127.0.0.1:3000/api/users/${e}`),t.send(),t.onload=function(){200!=t.status?console.log(`Ошибка ${t.status}: ${t.statusText}`):function(e){let t=document.querySelector(".card-details-content"),n=document.querySelector("#detail-card").content.cloneNode(!0),o=document.querySelector(".employees-block");o.style.display="none",n.querySelector(".avatar").src=e.avatar,n.querySelector(".name").innerHTML=e.name,n.querySelector(".nativeName").innerHTML=e.nativeName;let r=n.querySelector(".gender");1===e.gender?r.innerHTML="Mr":r.innerHTML="Mrs",n.querySelector(".department").innerHTML=e.department,n.querySelector(".room").innerHTML=e.room;let l=n.querySelectorAll(".contacts");l[0].innerHTML=e.internalPhone,l[1].innerHTML=e.mobilePhone,l[2].innerHTML=e.email,l[3].innerHTML=e.skype,l[4].innerHTML=e.cnumber,t.append(n),document.querySelector(".back-to-list-btn").addEventListener("click",(function(){!function(e){document.querySelector(".card-information").remove(),e.style.display="block"}(o)}))}(JSON.parse(t.response))}}}()}function i(){document.querySelector(".sign-in-block").style.display="block",document.querySelector(".sign-up-block").style.display="none",document.querySelector(".sign-in-send").addEventListener("click",(function(t){t.preventDefault(),function(){let t=document.querySelector(".sign-in-email").value,n=document.querySelector(".sign-in-password").value,o=new XMLHttpRequest,r={email:t,password:n},l=JSON.stringify(r),s=new Headers;s.append("Access-Control-Allow-Credentials","true"),s.append("Access-Control-Allow-Origin","*"),s.append("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),o.open("POST","http://127.0.0.1:3000/api/auth"),o.setRequestHeader("Content-type","application/json; charset=utf-8"),o.send(l),o.onload=function(){if(200!==o.status)console.log(`Ошибка ${o.status}: ${o.statusText}`);else{let t=o.response;"User doesn't exist!"===t||"Wrong password!"===t?document.querySelector(".sign-in-error").innerHTML=t:(localStorage.setItem("currentUser",t),e(JSON.parse(localStorage.getItem("currentUser"))),document.querySelector(".sign-in-block").style.display="none")}}}()}))}document.querySelector(".search-form").addEventListener("submit",(function(e){e.preventDefault(),function(){let e=document.querySelector(".search-input").value,t=new XMLHttpRequest;t.open("GET","http://127.0.0.1:3000/api/users"),t.send(),t.onload=function(){200!==t.status?console.log(`Ошибка ${t.status}: ${t.statusText}`):function(t){let n=t.filter((t=>t.name.toUpperCase().includes(e.toUpperCase())||t.nativeName.toUpperCase().includes(e.toUpperCase()))),o=document.querySelectorAll(".employee-single");for(let e of o)e.remove();a(n),c.classList.contains("active")?l():s()}(JSON.parse(t.response))}}()})),document.querySelector(".logout").addEventListener("click",i),document.querySelector(".sign-up-button").addEventListener("click",(function(){document.querySelector(".sign-up-block").style.display="block",document.querySelector(".sign-in-block").style.display="none",document.querySelector(".sign-up-send").addEventListener("click",t)})),document.querySelector(".sign-in-button").addEventListener("click",i)})();